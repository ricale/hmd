/*! hmd - v0.2.8d - 2014-10-14
* Copyright (c) 2014 ricale; Licensed  */
Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]}),window.hmd=function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m="p",n="h1",o="h2",p="h3",q="h4",r="h5",s="h6",t="hr",u="ul",v="ol",w="blank",x="codeblock",y="blockquote",z=/^[ ]{0,3}(>+)[ ]?([ ]*.*)$/,A=/^=+$/,B=/^-+$/,C=/^[ ]{0,3}([-_*][ ]*){3,}$/,D=/^([\s]*)[*+-][ ]+(.*)$/,E=/^([\s]*)[\d]+\.[ ]+(.*)$/,F=/^[\s]*$/,G=/^([ ]{1,8})([\s]*)(.*)/,H=/^([ ]{0,3}\t|[ ]{4})([\s]*.*)$/,I=/^(#{1,6}) (.*[^#])(#*)$/,J=[/^[ ]{0,3}\[([^\]]+)\]:[\s]*<([^\s>]+)>[\s]*(?:['"(](.*)["')])?$/,/^[ ]{0,3}\[([^\]]+)\]:[\s]*([^\s]+)[\s]*(?:['"(](.*)["')])?$/];return c=function(){var a,b=/\\([\\\-\*\.\[\]\(\)_+<>#`^])/g,c=/;;ESCAPE([0-9]+);;/g,d=["-","_","*","+",".","<",">","#","[","]","(",")","`","\\","^"],e=["-","_","*","+",".","&lt;","&gt;","#","[","]","(",")","`","\\","^"],f={};for(a in d)d.hasOwnProperty(a)&&(f[d[a]]=";;ESCAPE"+a+";;");return function(){return{decode:function(a){return a=a.replace(b,function(a,b){return f[b]})},escape:function(a){return a=a.replace(c,function(a,b){return e[b]})}}}()}(),d=function(){var a,b=0,c=1,d=2,e=[],f=/;;REPLACER([0-9]+);;/g,g={},h=function(a,b){return{url:a,title:b}},i=function(a,b,c,d){return{regexp:a,type:b,result:c,notReplaced:d||null}},j=function(){return";;REPLACER"+(e.length-1)+";;"},k=function(a){return void 0===a?"":' title="'+a+'"'};return a=[i(/!\[([^\]]+)\][\s]*\[([^\]]*)\]/g,d,function(a,b,c){return'<img src="'+a+'" alt="'+b+'"'+k(c)+">"}),i(/\[([^\]]+)\][\s]*\[([^\]]*)\]/g,d,function(a,b,c){return'<a href="'+a+'" alt="'+b+'"'+k(c)+">"},function(a){return a+"</a>"}),i(/``[\s]*(.+?)[\s]*``/g,c,function(a){return"<code>"+a.replace(/</g,"&lt;")+"</code>"}),i(/`([^`]+)`/g,c,function(a){return"<code>"+a.replace(/</g,"&lt;")+"</code>"}),i(/!\[([^\]]+)\][\s]*\(([^\s\)]+)(?: "(.*)")?\)/g,c,function(a,b,c){return'<img src="'+b+'"'+k(c)+">"}),i(/\[([^\]]+)\][\s]*\(([^\s\)]+)(?: "(.*)")?\)/g,c,function(a,b,c){return'<a href="'+b+'"'+k(c)+">"},function(a){return a+"</a>"}),i(/<(http[s]?:\/\/[^<]+)>/g,c,function(a){return'<a href="'+a+'">'+a+"</a>"}),i(/\*\*([^\*\s]{1,2}|\*[^\*\s]|[^\*\s]\*|(?:[^\s].+?[^\s]))\*\*/g,b,"<strong>$1</strong>"),i(/__([^_\s]{1,2}|_[^_\s]|[^_\s]_|(?:[^\s].+?[^\s]))__/g,b,"<strong>$1</strong>"),i(/\*([^\*\s]{1,2}|[^\s].+?[^\s])\*/g,b,"<em>$1</em>"),i(/_([^_\s]{1,2}|[^\s].+?[^\s])_/g,b,"<em>$1</em>"),i(/(  )$/,b,"<br/>"),i(/<(?=[^>]*$)/g,b,"&lt;")],function(){return{init:function(){e=[],g={}},addRule:function(c){var d;for(d in c)c.hasOwnProperty(d)&&(a[a.length]=i(c[d][0],b,c[d][1]))},addReference:function(a,b,c){g[a]=h(b,c)},decode:function(f){var h,i,k,l=function(a,b,c,d){return e[e.length]=i.result(b,c,d),j()+(null!==i.notReplaced?i.notReplaced(b):"")},m=function(a,b,c){return k=g[c||b],void 0===k?a:(e[e.length]=i.result(k.url,b,k.title),j()+(null!==i.notReplaced?i.notReplaced(b):""))};for(h in a)if(a.hasOwnProperty(h))switch(i=a[h],i.type){case b:f=f.replace(i.regexp,i.result);break;case c:f=f.replace(i.regexp,l);break;case d:f=f.replace(i.regexp,m)}return f},escape:function(a){return a=a.replace(f,function(a,b){return e[b]}),e=[],a}}}()}(),f=function(){var a=[],b=null;return function(){return{init:function(){a=[],b=null},push:function(b){b.index=a.length,a.push(b)},setCurrentIndex:function(c){return b=0>c?null:c>=a.length?null:c},goNext:function(){return this.setCurrentIndex(null!==b?b+1:0)},current:function(){return a[b]},last:function(b){return void 0===b?a.last():void(a[a.length-1].tag=b.tag)},get:function(b){return a[b]},size:function(){return a.length},previousLine:function(c){return c=void 0===c?b:c,c>1?a[c-1]:null},nextLine:function(c){return c=void 0===c?b:c,c<a.length-1?a[c+1]:null},previousBlank:function(c){var d;for(c=void 0===c?b:c,d=c-1;d>=0;d--)if(a[d].isBlank())return a[d];return null},nextBlank:function(c){var d;for(c=void 0===c?b:c,d=c+1;d<a.length;d++)if(a[d].isBlank())return a[d];return null},previousLineExceptBlank:function(c){var d;for(c=void 0===c?b:c,d=c-1;d>=0;d--)if(a[d].isNotBlank())return a[d];return null},nextLineExceptBlank:function(c){var d;for(c=void 0===c?b:c,d=c+1;d<a.length;d++)if(a[d].isNotBlank())return a[d];return null},previousChunk:function(c){var d,e,f;for(c=void 0===c?b:c,d=c-1;d>=0;d--){if(a[d].isHeading()||a[d].isHorizontalLine())return null;if(a[d].isBlank())return e=this.previousLineExceptBlank(d),null===e?null:(f=this.previousBlank(e.index),null===f?e:a[f.index+1])}return null},nextChunk:function(c){var d;for(c=void 0===c?b:c,d=c+1;d<a.length;d++){if(a[d].isHeading()||a[d].isHorizontalLine()||a[d].isList()&&a[d].listLevel()==this.current().listLevel())return null;if(a[d].isBlank())return this.nextLineExceptBlank(d)}return null},previousList:function(c){var d,e=!1;for(c=void 0===c?b:c,d=c-1;d>=0;d--){if(a[d].isHeading()||a[d].isHorizontalLine())return null;if(a[d].isBlank()){if(e)return null;e=!0}else{if(a[d].isNotBlank()&&0===a.level)return null;if(a[d].isList())return a[d]}}return null}}}()}(),g=function(){var a=[],b=0,c=0;return function(){return{init:function(){a=[],b=0,c=0},push:function(d,e){var f;switch(e=void 0===e?0:e,f=a.length>0&&(a.last().tag==m||a.last().tag==x)?this.pop():"",d==y?b+=1:(d==u||d==v)&&(c=e,0!==c&&(c+=100*b)),a.push({tag:d,level:e}),d){case y:return f+"<blockquote>";case u:return f+"<ul><li>";case v:return f+"<ol><li>";case m:return f+"<p>";case n:return f+"<h1>";case o:return f+"<h2>";case p:return f+"<h3>";case q:return f+"<h4>";case r:return f+"<h5>";case s:return f+"<h6>";case x:return f+"<pre><code>";case t:return f+"<hr/>"}},pushToQuoteLevel:function(a){for(var b="";a>this.quoteLevel();)b+=this.push(y,a);return b},pop:function(){var d,e,f;if(a.length>0)if(e=a.last(),e.tag==y)b-=1;else if(e.tag==u||e.tag==v){for(c=0,d=a.length-2;d>=0;d--)if(a[d].tag!=y){c=a[d].level;break}0!==c&&(c+=100*b)}switch(f=a.pop(),f.tag){case y:return"</blockquote>";case u:return"</li></ul>";case v:return"</li></ol>";case m:return"</p>";case n:return"</h1>";case o:return"</h2>";case p:return"</h3>";case q:return"</h4>";case r:return"</h5>";case s:return"</h6>";case x:return"</code></pre>";case t:return""}},popToQuoteLevel:function(a){for(var b="";a<this.quoteLevel();)b+=this.pop();return b},popToListLevel:function(a){for(var b="";this.isNotEmpty()&&this.lastIsNotBlockquote()&&a<this.listLevel();)b+=this.pop();return b},popToBlockquote:function(){for(var a="";this.isNotEmpty()&&this.lastIsNotBlockquote();)a+=this.pop();return a},last:function(){return a.last()},listLevel:function(){return c},quoteLevel:function(){return b},isEmpty:function(){return 0===a.length},isNotEmpty:function(){return 0!==a.length},lastIsBlockquote:function(){var b=a.last();return b&&b.tag==y},lastIsNotBlockquote:function(){var b=a.last();return!b||b.tag!=y},lastIsParagraph:function(){var b=a.last();return b&&b.tag==m},lastIsNotParagraph:function(){var b=a.last();return!b||b.tag!=m},lastIsList:function(){var b=a.last();return b&&(b.tag==u||b.tag==v)},lastIsNotList:function(){var b=a.last();return!b||b.tag!=u&&b.tag!=v},lastIsCodeblock:function(){var b=a.last();return b&&b.tag==x},lastIsNotCodeblock:function(){var b=a.last();return!b||b.tag!=x},size:function(){return a.length},stack:function(){return a}}}()}(),e=function(){this.index=null,this.content=null,this.tag=null,this.level=0,this.quote=0},e.prototype={listLevel:function(){return 0===this.level?0:this.level+100*this.quote},isParagraph:function(){return this.tag==m},isUnorderedList:function(){return this.tag==u},isOrderedList:function(){return this.tag==v},isList:function(){return this.isUnorderedList()||this.isOrderedList()},isBlank:function(){return this.tag==w},isCodeblock:function(){return this.tag==x},isHeading:function(){return this.tag==n||this.tag==o||this.tag==p||this.tag==q||this.tag==r||this.tag==s},isHorizontalLine:function(){return this.tag==t},isNotParagraph:function(){return this.tag!=m},isNotUnorderedList:function(){return this.tag!=u},isNotOrderedList:function(){return this.tag!=v},isNotList:function(){return this.isNotUnorderedList()&&this.isNotOrderedList()},isNotBlank:function(){return this.tag!=w},isNotCodeblock:function(){return this.tag!=x},isNotHeading:function(){return this.tag!=n&&this.tag!=o&&this.tag!=p&&this.tag!=q&&this.tag!=r&&this.tag!=s},isNotHorizontalLine:function(){return this.tag!=t}},h=function(c){var e,h,j,k=c.split(/\n/),m=function(){d.init(),a=[],b=[],f.init(),g.init()},n=function(a){return a.isNotBlank()&&0===a.level},o=function(){a.length>0&&(a=[],b=[]),b.length>0&&(b=[])};for(j=this,m(),e=0;e<k.length;e++)null!==(h=i(k[e]))&&(f.push(h),n(h)&&o());return l()},i=function(c){var g,h=j(c),l=null,y=function(){return null!==h.content.match(F)},z=function(){return null!==h.content.match(A)&&0!==f.size()&&f.last().isParagraph()},K=function(){return null!==h.content.match(B)&&0!==f.size()&&f.last().isParagraph()},L=function(){return null!==h.content.match(C)},M=function(c,d){var f,g,i=function(d){var f=function(c,d){var f,g,h,i=k(c),j=new e,l=d?b:a,n=function(){return 0===l.length},o=function(){return 1==l.length},p=function(){return i==l[0]},q=function(){return i>=4*(f+1)},r=function(){return i>l[f-1]&&i>4*(f-1)},s=function(){return i>=l[f-1]};if(n())3>=i?(l[0]=i,j.level=1):j.tag=x;else if(o())p()?j.level=1:7>=i?(l[1]=i,j.level=2):j.tag=x;else if(f=l.length,q())j.tag=m,j.level=f;else if(r())l[f]=i,j.level=f+1;else if(s())j.level=f;else{for(g=!1,h=f-2;h>=0;h--)if(i>=l[h]){l=l.slice(0,h+1),j.level=h+1,g=!0;break}g||(j.tag=m,j.level=f)}return d?(j.level+=a.length,b=l):a=l,l=null,j},g=f(d[1],0!==h.quote);return g.isNotCodeblock()?(h.tag=null!==g.tag?g.tag:c,h.level=g.level,h.content=d[2],h):!1};return(f=h.content.match(d))?(g=i(f))!==!1?g:S(h):null},N=function(){return M(u,D,h)},O=function(){return M(v,E,h)},P=function(a,b){var c,d=function(){return null!==o&&0!==o.level},g=function(){return null!==p&&o.isCodeblock()&&8==k(p[1])&&4*(o.level-1)<=k(p[2])},h=function(){return null!==n&&0!==n.level},l=new e,n=f.previousLineExceptBlank(f.size()),o=f.previousLine(f.size()),p=a.match(G);if(d())return g()?(l.tag=x,l.content=p[2].slice(4*(o.level-1))+p[3],l.level=o.level,l.quote=b.quote,l):(l=j(a),l.tag=m,l.level=o.level,l);if(h()){if(null===p)if(l=j(a),l.quote==n.quote){if(p=l.content.match(G),null===p)return null}else{if(n=f.previousList(f.size()),!n||l.quote!=n.quote)return null;if(p=l.content.match(G),null===p)return null}return 8==k(p[1])&&4*(n.level-1)<=k(p[2])?(l.tag=x,l.content=p[2].slice(4*(n.level-1))+p[3],l.level=n.level,l.quote=b.quote,l):(l=i(p[3]),c=k(p[1]+p[2]),c=c/4-c/4%1+(c%4!==0),l.level+=c>n.level?n.level:c,l.quote=n.quote,l)}return null},Q=function(){var a,b;if(a=h.content.match(I)){switch(b=a[1].length){case 1:h.tag=n;break;case 2:h.tag=o;break;case 3:h.tag=p;break;case 4:h.tag=q;break;case 5:h.tag=r;break;case 6:h.tag=s}return h.content=a[2],h}return null},R=function(){var a;return null===(a=h.content.match(J[0]))?a=h.content.match(J[1]):a},S=function(){return(l=h.content.match(H))?(h.tag=x,h.content=l[2],h):null},T=function(){return h.tag=w,h.content="",h},U=function(){return f.last({tag:n}),null},V=function(){return f.last({tag:o}),null},W=function(){return h.tag=t,h.content="",h},X=function(){return d.addReference(g[1],g[2],g[3]),null},Y=function(){return h.tag=m,h};return y()?T():z()?U():K()?V():L()?W():(g=N())?g:(g=O())?g:(g=P(c,h))?g:(g=Q())?g:(g=R())?X():(g=S())?g:Y()},j=function(a){var b=new e,c=null;for(b.content=a;;){if(c=b.content.match(z),null===c)return b;b.quote+=c[1].length,b.content=c[2]}},k=function(a){var b,c=a.match(/([ ]{0,3}\t|[ ]{4}|[ ]{1,3})/g),d=0;if(null!==c)for(b=0;b<c.length;b++)d+=null!==c[b].match(/^[ ]{1,3}$/)?c[b].length:4;return d},l=function(){for(var a,b=function(){var b=f.nextLineExceptBlank();a.isNotParagraph()&&g.lastIsParagraph()&&(k+=g.pop()),g.lastIsCodeblock()&&(a.isNotCodeblock()&&a.isNotBlank()||a.isBlank()&&(null===b||b.isNotCodeblock()))&&(k+=g.pop())},e=function(){var b=f.previousLine(),c=function(){a.listLevel()<g.listLevel()?k+=g.popToListLevel(a.listLevel()):a.listLevel()==g.listLevel()&&a.isList()&&(k+=a.tag!=g.last().tag?g.pop():"</li>")};a.quote<g.quoteLevel()?(b.isBlank()&&(k+=g.popToQuoteLevel(a.quote)),c()):a.quote>g.quoteLevel()?(b&&b.isBlank()&&(k+=g.popToBlockquote()),k+=g.pushToQuoteLevel(a.quote)):c()},h=function(){var a,b,c,d=f.current();d.isList()&&d.listLevel()>g.listLevel()?k+=g.push(d.tag,d.level):d.listLevel()==g.listLevel()&&d.isList()&&(k+="<li>"),(g.isEmpty()||g.lastIsNotParagraph())&&0!==d.level&&(a=f.previousLine(),d.isParagraph()&&a.isBlank()?d.listLevel()==g.listLevel()&&(k+=g.push(m)):d.isList()&&(c=f.nextChunk(),b=f.previousChunk(),c&&d.listLevel()==c.listLevel()?k+=g.push(m):b&&d.listLevel()==b.listLevel()&&(k+=g.push(m))))},i=function(){a.isHeading()||a.isHorizontalLine()?k+=g.push(a.tag):a.isParagraph()?(g.isEmpty()||g.lastIsNotParagraph())&&0===g.listLevel()&&(k+=g.push(a.tag)):a.isCodeblock()&&g.lastIsNotCodeblock()&&(k+=g.push(a.tag))},j=function(){a.isCodeblock()?a.content=a.content.replace(/[<>&]/g,function(a){switch(a){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;"}}):(a.content=c.decode(a.content),a.content=d.decode(a.content),a.content=d.escape(a.content),a.content=c.escape(a.content)),k+=a.isHeading()||a.isHorizontalLine()?a.content+g.pop():a.isBlank()?"\n":a.isCodeblock()?a.content+"\n":a.content},k="";null!==f.goNext();)a=f.current(),b(),a.isNotBlank()&&(e(),h()),i(),j();return k},function(){return{decode:function(a){return h.call(this,a)},run:function(a,b,c){var d=function(){var c=a,d=b.scrollHeight,e=b.clientHeight,f=c.scrollTop,g=c.scrollHeight,h=c.clientHeight,i=f/(g-h)*(d-e);b.scrollTop=i},e=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=function(b,c,d){a.value=k.substring(0,b)+d+k.substring(c,k.length)},r=function(){return k.lastIndexOf("\n",f-1)},s=function(){var a=k.indexOf("\n",g);return-1==a?k.length-1:a},t=function(b,c){a.selectionStart=b,a.selectionStart<h+1&&(a.selectionStart=h+1),c<a.selectionStart&&(c=a.selectionStart),a.selectionEnd=c},u="    ",v=null;if(document.selection)a.focus(),n=document.selection.createRange(),n.text=u;else if(k=a.value,f=a.selectionStart,g=a.selectionEnd,l=k.substring(f,g),null===l.match(/\n/))b?(h=r(),i=s(),m=k.substring(h,i),v=/(^|\n)([ ]{1,4})/,c=null===m.match(v)?0:m.match(v)[2].length,q(h,i,m.replace(v,"$1")),t(f-c,f-c)):(q(f,g,u),t(f+u.length,f+u.length));else if(b){if(h=r(),i=s(),m=k.substring(h,i),v=/(^|\n)([ ]{1,4})/g,d=m.match(v),c=0,e=0,null!==d){for(j=l.match("\n[ ]{0,3}$"),o=0;o<d.length;o++)p=d[o],c+=o==d.length-1&&j?j[0].length-1:p.match(/[ ]+/)[0].length;null!==k.substring(h,f).match(v)&&(e=d[0].match(/[ ]+/)[0].length)}q(h,i,m.replace(v,"$1")),t(f-e,g-c)}else h=r(),i=s(),m=k.substring(h,i),v=/(^|\n)(?!\n)/g,q(h,i,m.replace(v,"$1"+u)),t(f+u.length,g+u.length*l.match(v).length)},f=function(a,b){var c;document.createEvent?(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0)):(c=document.createEventObject(),c.eventType=b),c.eventName=b,document.createEvent?a.dispatchEvent(c):a.fireEvent("on"+c.eventType,c)},g=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a[b]=c},i=function(b){n||-1!=navigator.userAgent.toLowerCase().indexOf("firefox")&&(0===b.keyCode?null===l&&(l=setInterval(function(){f(a),n=!0},1e3)):null!==l&&(clearInterval(l),l=null))},j=function(f){void 0!==f&&9==f.keyCode&&c.UseTabKey&&(f.preventDefault(),e(this,f.shiftKey)),m||(m=setTimeout(function(){b.innerHTML=h.call(k,a.value),c.AutoScrollPreview&&d(),m=null},100))},k=this,l=null,m=null,n=!1;c=void 0===c?{}:c,c.UseTabKey=void 0===c.UseTabKey?!0:c.UseTabKey,c.TabCharacter=void 0===c.TabCharacter?"space":c.TabCharacter,c.AutoScrollPreview=void 0===c.AutoScrollPreview?!0:c.AutoScrollPreview,g(a,"keydown",i),g(a,"keydown",j),j(),c.AutoScrollPreview&&g(a,"scroll",d)},addInlineRules:function(a){d.addRule(a)}}}()}(),hmd.addInlineRules([[/--([^-\s]{1,2}|-[^-\s]|[^-\s]-|(?:[^\s].+?[^\s]))--/g,"<del>$1</del>"],[/,,([^,\s]{1,2}|,[^,\s]|[^,\s],|(?:[^\s].+?[^\s])),,/g,"<sub>$1</sub>"],[/\^\^([^\^\s]{1,2}|\^[^\^\s]|[^\^\s]\^|(?:[^\s].+?[^\s]))\^\^/g,"<sup>$1</sup>"]]);